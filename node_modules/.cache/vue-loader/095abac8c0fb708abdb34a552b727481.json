{"remainingRequest":"/Users/yuxue/Desktop/web/data_collect_web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yuxue/Desktop/web/data_collect_web/src/components/DB/DBStore.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yuxue/Desktop/web/data_collect_web/src/components/DB/DBStore.vue","mtime":1625302318272},{"path":"/Users/yuxue/Desktop/web/data_collect_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuxue/Desktop/web/data_collect_web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/yuxue/Desktop/web/data_collect_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yuxue/Desktop/web/data_collect_web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIGNhbmFsTGlzdDogWwogICAgICAgIHsKICAgICAgICAgIHRvcGljOiAnMScKICAgICAgICB9CiAgICAgIF0sCiAgICAgIC8vIOmAieaLqeeahOaVsOaNruihqOeahOWQjeWtlwogICAgICAvLyDngrnlh7vmlbDmja7lhaXlupPmjInpkq7lvLnlh7rnmoTlr7nor53moYYKICAgICAgZGF0YVN0b3JlVmlzaWJsZTogZmFsc2UsCiAgICAgIC8vIOeIrOiZq+S/neWtmOaVsOaNruahiOS+iwogICAgICBzdHJpbmdJbmZvOiAnJywKICAgICAgZHJvcEluZm86IHsKICAgICAgICB0YWJsZUxpc3Q6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgdGFibGVOYW1lOiAn5ZCM5q2l6KGo5ZCNJywKICAgICAgICAgICAgc3luY09wZXJhdGU6IFtdCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICB0b3BpYzogJycsCiAgICAgICAgdGltZTogewogICAgICAgICAgZGF5OiAnJywKICAgICAgICAgIGhvdXI6ICcnLAogICAgICAgICAgbWluOiAnJywKICAgICAgICAgIHNlY29uZDogJycKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQgKCkgewogICAgdGhpcy5nZXRDYW5hbExpc3QoKQogICAgdGhpcy5nZXREQlRhYmxlTGlzdCgpCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBnZXRDYW5hbExpc3QgKCkgewogICAgICBjb25zdCB7IGRhdGE6IHJlcyB9ID0gYXdhaXQgdGhpcy4kaHR0cC5nZXQoJ2xpc3RDYW5hbCcpCiAgICAgIGNvbnNvbGUubG9nKHJlcykKICAgICAgaWYgKHJlcy5jb2RlICE9PSAyMDApIHsKICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign5pWw5o2u5bqT5ZCM5q2l5a6e5L6L6I635Y+W5aSx6LSlJykKICAgICAgfQogICAgICB0aGlzLmNhbmFsTGlzdCA9IHJlcy5lbnRpdHkKICAgIH0sCiAgICBhc3luYyBkYXRhU3RvcmUgKHdlYnNpdGUpIHsKICAgICAgdGhpcy5kYXRhU3RvcmVWaXNpYmxlID0gdHJ1ZQogICAgICBjb25zb2xlLmxvZyh3ZWJzaXRlKQogICAgICB0aGlzLmRyb3BJbmZvLnRvcGljID0gd2Vic2l0ZS50b3BpYwogICAgfSwKICAgIGFzeW5jIGRhdGFTdG9yZVN1Ym1pdCAoZHJvcEluZm8pIHsKICAgICAgLy8gZGF0YXN0b3JlCiAgICAgIGNvbnN0IHRpbWUgPSAoZHJvcEluZm8udGltZS5zZWNvbmQpICsgZHJvcEluZm8udGltZS5taW4gKiA2MCArIGRyb3BJbmZvLnRpbWUuaG91ciAqIDM2MDAgKyBkcm9wSW5mby50aW1lLmRheSAqIDM2MDAgKiAyNAogICAgICBjb25zdCBwYXJhbXMgPSB7fQogICAgICBwYXJhbXMuc2Vjb25kcyA9IHRpbWUKICAgICAgcGFyYW1zLnRvcGljID0gZHJvcEluZm8udG9waWMKICAgICAgcGFyYW1zLnRhYmxlTGlzdCA9IGRyb3BJbmZvLnRhYmxlTGlzdAogICAgICBjb25zb2xlLmxvZyhwYXJhbXMpCiAgICAgIGNvbnN0IHsgZGF0YTogcmVzIH0gPSBhd2FpdCB0aGlzLiRodHRwLnBvc3QoJ2FkZENvbnN1bWVyJywgcGFyYW1zKQogICAgICBpZiAocmVzLmNvZGUgIT09IDIwMCkgewogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfmlbDmja7lupPlkIzmraXlpLHotKUnKQogICAgICB9CiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5pWw5o2u5ZCM5q2l5oiQ5YqfJykKICAgIH0sCiAgICByZXNldEZvcm0gKCkgewogICAgICAvLyDph43nva7mlrDlop7pobXpnaLnmoTmlbDmja4KICAgICAgY29uc29sZS5sb2codGhpcy4kcmVmcy5hZGRGb3JtUmVmKQogICAgICB0aGlzLiRyZWZzLmFkZEZvcm1SZWYucmVzZXRGaWVsZHMoKQogICAgfSwKICAgIGFzeW5jIG9wZW5JbnN0YW5jZSAoaW5zdGFuY2UpIHsKICAgICAgY29uc29sZS5sb2coaW5zdGFuY2UpCiAgICAgIGNvbnN0IHsgZGF0YTogcmVzIH0gPSBhd2FpdCB0aGlzLiRodHRwLnBvc3QoJ3N0YXJ0Q2FuYWxJbnN0YW5jZScsIGluc3RhbmNlKQogICAgICBpZiAocmVzLmNvZGUgIT09IDIwMCkgewogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCflrp7kvovlkK/liqjlpLHotKUnKQogICAgICB9CiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5a6e5L6L5ZCv5Yqo5oiQ5YqfJykKICAgIH0sCiAgICBhc3luYyBzdG9wSW5zdGFuY2UgKGluc3RhbmNlKSB7CiAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKQogICAgICBwYXJhbXMuYXBwZW5kKCd0b3BpYycsIGluc3RhbmNlLnRvcGljKQogICAgICBjb25zdCB7IGRhdGE6IHJlcyB9ID0gYXdhaXQgdGhpcy4kaHR0cC5wb3N0KCdzdG9wS2Fma2FDb25zdW1lcicsIHBhcmFtcykKICAgICAgaWYgKHJlcy5jb2RlICE9PSAyMDApIHsKICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign5YGc5q2i5ZCM5q2l5aSx6LSlJykKICAgICAgfQogICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCflgZzmraLlkIzmraXmiJDlip8nKQogICAgfSwKICAgIHJlbW92ZU5ld1RhZyAoaW5kZXgpIHsKICAgICAgdGhpcy5kcm9wSW5mby50YWJsZUxpc3QucG9wKGluZGV4KQogICAgfSwKICAgIGFkZE5ld0Ryb3AgKCkgewogICAgICB0aGlzLmRyb3BJbmZvLnRhYmxlTGlzdC5wdXNoKHsKICAgICAgICB0YWJsZU5hbWU6ICcnLAogICAgICAgIHN5bmNPcGVyYXRlOiBbXQogICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["DBStore.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DBStore.vue","sourceRoot":"src/components/DB","sourcesContent":["<template>\n  <div>\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\n      <el-breadcrumb-item :to=\"{ path: '/welcome' }\">首页</el-breadcrumb-item>\n      <el-breadcrumb-item>采集设备管理</el-breadcrumb-item>\n      <el-breadcrumb-item>远程数据库</el-breadcrumb-item>\n      <el-breadcrumb-item>数据入库与告警</el-breadcrumb-item>\n      <el-breadcrumb-item>数据入库</el-breadcrumb-item>\n    </el-breadcrumb>\n    <el-card >\n      <el-table :data = 'canalList' stripe border style=\"width: 100%\">\n        <el-table-column type=\"index\"></el-table-column>\n        <el-table-column prop=\"additionalInfo\" label=\"实例名称\"></el-table-column>\n        <el-table-column prop=\"serverAddress\" label=\"canal-Ip\"></el-table-column>\n        <el-table-column prop=\"port\" label=\"canal-Port\"></el-table-column>\n        <el-table-column prop=\"destination\" label=\"监控队列名称\"></el-table-column>\n        <el-table-column prop=\"topic\" label=\"Kafka-Topic\"></el-table-column>\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-tooltip content=\"启动实例\" placement=\"top\">\n              <el-button type=\"success\" size=\"mini\" @click=\"openInstance(scope.row)\" icon = \"el-icon-switch-button\"></el-button>\n            </el-tooltip>\n            <el-tooltip content=\"数据同步\" placement=\"top\">\n              <el-button type=\"primary\" size=\"mini\" @click=\"dataStore(scope.row)\" icon=\"el-icon-refresh\"></el-button>\n            </el-tooltip>\n            <el-tooltip content=\"停止同步\" placement=\"top\">\n              <el-button type=\"danger\" size=\"mini\" @click=\"stopInstance(scope.row)\" icon=\"el-icon-circle-close\"></el-button>\n            </el-tooltip>\n          </template>\n        </el-table-column>\n      </el-table>\n      <el-dialog title=\"数据同步\" :visible.sync= \"dataStoreVisible\" width=\"50%\" @close=\"resetForm()\">\n        <el-form :model=\"dropInfo\" :rules= \"addruleForm\" ref=\"addFormRef\" label-width=\"100px\" margin-top=\"3px\">\n          <el-card v-for=\"(item,index) in dropInfo.tableList\" :key=\"index\" style=\"margin:2px\">\n            <el-button v-if=\"index!==0\" type=\"danger\" @click=\"removeNewTag(index)\" icon=\"el-icon-delete\" size=\"mini\"></el-button>\n            <el-button v-else type=\"primary\" @click=\"addNewDrop()\" size=\"mini\">+</el-button>\n            <el-form-item prop =\"item.tableName\" label=\"同步表名:\" >\n              <el-input v-model=\"dropInfo.tableList[index].tableName\" placeholder=\"请输入同步表名\"></el-input>\n            </el-form-item>\n            <el-form-item prop=\"item.syncOperate\" label=\"同步操作\">\n                <el-checkbox-group v-model=\"dropInfo.tableList[index].syncOperate\" size=\"mini\">\n                  <el-checkbox label=\"1\" border>创建表</el-checkbox>\n                  <el-checkbox label=\"2\" border>删除表</el-checkbox>\n                  <el-checkbox label=\"3\" border>插入记录</el-checkbox>\n                  <el-checkbox label=\"4\" border>更新记录</el-checkbox>\n                  <el-checkbox label=\"5\" border>删除记录</el-checkbox>\n                </el-checkbox-group>\n              </el-form-item>\n          </el-card>\n          <el-row>\n            <el-col>同步定时设置：</el-col>\n            <e-col><el-input-number size=\"mini\" v-model=\"dropInfo.time.day\" controls-position=\"right\" :min=\"0\"></el-input-number><span>天</span></e-col>\n            <e-col><el-input-number size=\"mini\" v-model=\"dropInfo.time.hour\" controls-position=\"right\" :min=\"0\"></el-input-number><span>时</span></e-col>\n            <e-col><el-input-number size=\"mini\" v-model=\"dropInfo.time.min\" controls-position=\"right\" :min=\"0\"></el-input-number><span>分</span></e-col>\n            <e-col><el-input-number size=\"mini\" v-model=\"dropInfo.time.second\" controls-position=\"right\" :min=\"0\"></el-input-number><span>秒</span></e-col>\n          </el-row>\n        </el-form>\n        <span slot=\"footer\">\n          <el-button @click=\"dataStoreVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"dataStoreSubmit(dropInfo)\">同步</el-button>\n        </span>\n      </el-dialog>\n    </el-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  data () {\n    return {\n      canalList: [\n        {\n          topic: '1'\n        }\n      ],\n      // 选择的数据表的名字\n      // 点击数据入库按钮弹出的对话框\n      dataStoreVisible: false,\n      // 爬虫保存数据案例\n      stringInfo: '',\n      dropInfo: {\n        tableList: [\n          {\n            tableName: '同步表名',\n            syncOperate: []\n          }\n        ],\n        topic: '',\n        time: {\n          day: '',\n          hour: '',\n          min: '',\n          second: ''\n        }\n      }\n    }\n  },\n  created () {\n    this.getCanalList()\n    this.getDBTableList()\n  },\n  methods: {\n    async getCanalList () {\n      const { data: res } = await this.$http.get('listCanal')\n      console.log(res)\n      if (res.code !== 200) {\n        return this.$message.error('数据库同步实例获取失败')\n      }\n      this.canalList = res.entity\n    },\n    async dataStore (website) {\n      this.dataStoreVisible = true\n      console.log(website)\n      this.dropInfo.topic = website.topic\n    },\n    async dataStoreSubmit (dropInfo) {\n      // datastore\n      const time = (dropInfo.time.second) + dropInfo.time.min * 60 + dropInfo.time.hour * 3600 + dropInfo.time.day * 3600 * 24\n      const params = {}\n      params.seconds = time\n      params.topic = dropInfo.topic\n      params.tableList = dropInfo.tableList\n      console.log(params)\n      const { data: res } = await this.$http.post('addConsumer', params)\n      if (res.code !== 200) {\n        return this.$message.error('数据库同步失败')\n      }\n      this.$message.success('数据同步成功')\n    },\n    resetForm () {\n      // 重置新增页面的数据\n      console.log(this.$refs.addFormRef)\n      this.$refs.addFormRef.resetFields()\n    },\n    async openInstance (instance) {\n      console.log(instance)\n      const { data: res } = await this.$http.post('startCanalInstance', instance)\n      if (res.code !== 200) {\n        return this.$message.error('实例启动失败')\n      }\n      this.$message.success('实例启动成功')\n    },\n    async stopInstance (instance) {\n      const params = new URLSearchParams()\n      params.append('topic', instance.topic)\n      const { data: res } = await this.$http.post('stopKafkaConsumer', params)\n      if (res.code !== 200) {\n        return this.$message.error('停止同步失败')\n      }\n      return this.$message.success('停止同步成功')\n    },\n    removeNewTag (index) {\n      this.dropInfo.tableList.pop(index)\n    },\n    addNewDrop () {\n      this.dropInfo.tableList.push({\n        tableName: '',\n        syncOperate: []\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.el-breadcrumb{\n  margin-bottom:15px;\n  font-size: 12px;\n}\n.el-card{\n  box-shadow: 0 1px 1px rgba(0,0,0,0.25);\n\n}\n.el-checkbox{\n  margin: 1px;\n}\n.el-input-number{\n  width: 75px;\n}\n</style>\n"]}]}